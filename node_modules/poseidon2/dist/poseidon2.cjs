"use strict";var f=Object.defineProperty;var g=(l,e,i)=>e in l?f(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i;var p=(l,e,i)=>(g(l,typeof e!="symbol"?e+"":e,i),i);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});class b{constructor(e){p(this,"prime");p(this,"zero",BigInt(0));p(this,"one",BigInt(1));this.prime=e}e(e){return typeof e=="bigint"?e%this.prime:BigInt(e)%this.prime}add(e,i){return(e+i)%this.prime}sub(e,i){return(this.prime+e-i)%this.prime}mul(e,i){return e*i%this.prime}square(e){return e*e%this.prime}div(e,i){return e/i%this.prime}}class I{constructor(e,i){p(this,"params");p(this,"primeField");this.params=e,this.primeField=i}getT(){return this.params.t}sbox(e){return e.map(i=>this.sboxP(i))}sboxP(e){const i=this.primeField.square(e);if(this.params.d==3)return this.primeField.mul(i,e);if(this.params.d==5)return this.primeField.mul(this.primeField.square(i),e);if(this.params.d==7)return this.primeField.mul(this.primeField.square(i),this.primeField.mul(i,e));throw new Error("Invalid d paramter, must be 3, 5 or 7")}matmulExternal(e){const i=this.params.t;if(i==2){const r=this.primeField.add(e[0],e[1]);e[0]=this.primeField.add(e[0],r),e[1]=this.primeField.add(e[1],r)}else if(i==3){const r=this.primeField.add(this.primeField.add(e[0],e[1]),e[2]);e[0]=this.primeField.add(e[0],r),e[1]=this.primeField.add(e[1],r),e[2]=this.primeField.add(e[2],r)}else if(i==4||i==8||i==12||i==16||i==20||i==24){const r=i/4;for(let s=0;s<r;s++){const t=s*4;let h=e[t];h=this.primeField.add(h,e[t+1]);let n=e[t+2];n=this.primeField.add(n,e[t+3]);let o=e[t+1];o=this.primeField.add(o,o),o=this.primeField.add(o,n);let F=e[t+3];F=this.primeField.add(F,F),F=this.primeField.add(F,h);let a=n;a=this.primeField.add(a,a),a=this.primeField.add(a,a),a=this.primeField.add(a,F);let m=h;m=this.primeField.add(m,m),m=this.primeField.add(m,m),m=this.primeField.add(m,o);let c=F;c=this.primeField.add(c,m);let _=o;_=this.primeField.add(_,a),e[t]=c,e[t+1]=m,e[t+2]=_,e[t+3]=a}const d=[this.primeField.zero,this.primeField.zero,this.primeField.zero,this.primeField.zero];for(let s=0;s<4;s++){d[s]=e[s];for(let t=1;t<r;t++)d[s]=this.primeField.add(d[s],e[4*t+s])}for(let s=0;s<e.length;s++)e[s]=this.primeField.add(e[s],d[s%4])}else throw new Error("Invalid t parameter, must be 2, 3, 4, 8, 12, 16, 20 or 24");return e}matmulInternal(e){const i=this.params.t;if(i==2){const r=this.primeField.add(e[0],e[1]);e[0]=this.primeField.add(e[0],r),e[1]=this.primeField.add(this.primeField.add(e[1],e[1]),r)}else if(i==3){const r=this.primeField.add(this.primeField.add(e[0],e[1]),e[2]);e[0]=this.primeField.add(e[0],r),e[1]=this.primeField.add(e[1],r),e[2]=this.primeField.add(this.primeField.add(e[2],e[2]),r)}else if(i==4||i==8||i==12||i==16||i==20||i==24){let r=e[0];for(let d=1;d<i;d++)r=this.primeField.add(r,e[d]);for(let d=0;d<e.length;d++)e[d]=this.primeField.add(this.primeField.mul(this.params.mat_internal_diag_m_1[d],e[d]),r)}else throw new Error("Invalid t parameter, must be 2, 3, 4, 8, 12, 16, 20 or 24");return e}permute(e){const i=this.params.t;if(e.length!=i)throw new Error("Invalid input length");let r=e;this.matmulExternal(r);for(let s=0;s<this.params.rounds_f_beginning;s++)r=this.addRc(r,this.params.round_constants[s]),r=this.sbox(r),this.matmulExternal(r);const d=this.params.rounds_f_beginning+this.params.rounds_p;for(let s=this.params.rounds_f_beginning;s<d;s++)r[0]=this.primeField.add(r[0],this.params.round_constants[s][0]),r[0]=this.sboxP(r[0]),this.matmulInternal(r);for(let s=d;s<this.params.rounds;s++)r=this.addRc(r,this.params.round_constants[s]),r=this.sbox(r),this.matmulExternal(r);return r}addRc(e,i){return e.map((r,d)=>this.primeField.add(r,i[d]))}}function P(l,e,i,r,d,s,t){const h=i/2,n=i+r;return{t:l,d:e,rounds_f_beginning:h,rounds_p:r,rounds_f_end:h,rounds:n,mat_internal_diag_m_1:d,_mat_internal:s,round_constants:t}}exports.F1Field=b;exports.Poseidon2=I;exports.getPoseidon2Params=P;
//# sourceMappingURL=poseidon2.cjs.map
